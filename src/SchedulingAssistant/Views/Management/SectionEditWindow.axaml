<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:SchedulingAssistant.ViewModels.Management"
        xmlns:models="using:SchedulingAssistant.Models"
        x:Class="SchedulingAssistant.Views.Management.SectionEditWindow"
        x:DataType="vm:SectionEditViewModel"
        x:CompileBindings="False"
        Title="{Binding FormTitle}"
        Width="620" Height="660"
        CanResize="True"
        ShowInTaskbar="False">

    <ScrollViewer>
        <StackPanel Spacing="12" Margin="20" MaxWidth="560" HorizontalAlignment="Left">
            <TextBlock Text="{Binding FormTitle}" FontSize="16" FontWeight="SemiBold" />

            <!-- Course picker -->
            <TextBlock Text="Course" Margin="0,0,0,4" />
            <ComboBox ItemsSource="{Binding Courses}"
                      SelectedValueBinding="{Binding Id}"
                      SelectedValue="{Binding SelectedCourseId}"
                      Margin="0,0,0,4" HorizontalAlignment="Stretch">
                <ComboBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:Course}">
                        <TextBlock>
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} — {1}">
                                    <Binding Path="CalendarCode" />
                                    <Binding Path="Title" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <!-- Section code -->
            <TextBlock Text="Section Code" Margin="0,0,0,4" />
            <TextBox Text="{Binding SectionCode}" Margin="0,0,0,4" />

            <!-- Schedule -->
            <TextBlock Text="Schedule" FontWeight="SemiBold" Margin="0,4,0,0" />

            <!-- List of added meetings -->
            <ItemsControl ItemsSource="{Binding Meetings}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:SectionMeetingViewModel}">
                        <Border BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="4"
                                Padding="8,6" Margin="0,0,0,6">
                            <Grid ColumnDefinitions="*,*,*,Auto" RowDefinitions="Auto,Auto">

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Day" FontSize="11" Foreground="#666666" Margin="0,0,4,2" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="Block length (hrs)" FontSize="11" Foreground="#666666" Margin="4,0,4,2" />
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="Start time" FontSize="11" Foreground="#666666" Margin="4,0,0,2" />

                                <ComboBox Grid.Row="1" Grid.Column="0"
                                          ItemsSource="{Binding AvailableDays}"
                                          SelectedValueBinding="{Binding Day}"
                                          SelectedValue="{Binding SelectedDay}"
                                          Margin="0,0,4,0"
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate DataType="{x:Type vm:DayOption}">
                                            <TextBlock Text="{Binding Name}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>

                                <ComboBox Grid.Row="1" Grid.Column="1"
                                          ItemsSource="{Binding AvailableBlockLengths}"
                                          SelectedItem="{Binding SelectedBlockLength}"
                                          PlaceholderText="Length"
                                          Margin="4,0,4,0"
                                          HorizontalAlignment="Stretch" />

                                <ComboBox Grid.Row="1" Grid.Column="2"
                                          ItemsSource="{Binding AvailableStartTimes}"
                                          SelectedItem="{Binding SelectedStartTime}"
                                          PlaceholderText="Start"
                                          Margin="4,0,0,0"
                                          HorizontalAlignment="Stretch">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource MinutesToTimeConverter}}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>

                                <Button Grid.Row="1" Grid.Column="3"
                                        Content="✕"
                                        Command="{Binding $parent[ItemsControl].DataContext.RemoveMeetingCommand}"
                                        CommandParameter="{Binding}"
                                        Margin="6,0,0,0"
                                        Padding="6,4"
                                        ToolTip.Tip="Remove this meeting" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Button Content="+ Add meeting" Command="{Binding AddMeetingCommand}" />

            <!-- Instructor + room -->
            <Grid ColumnDefinitions="*,*" Margin="0,4,0,0">
                <TextBlock Grid.Column="0" Text="Instructor" Margin="0,0,8,4" />
                <TextBlock Grid.Column="1" Text="Room" Margin="0,0,0,4" />
            </Grid>
            <Grid ColumnDefinitions="*,*" Margin="0,0,0,4">
                <ComboBox Grid.Column="0"
                          ItemsSource="{Binding Instructors}"
                          SelectedValueBinding="{Binding Id}"
                          SelectedValue="{Binding SelectedInstructorId}"
                          Margin="0,0,8,0" HorizontalAlignment="Stretch">
                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:Instructor}">
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0}, {1}">
                                        <Binding Path="LastName" />
                                        <Binding Path="FirstName" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding Rooms}"
                          SelectedValueBinding="{Binding Id}"
                          SelectedValue="{Binding SelectedRoomId}"
                          HorizontalAlignment="Stretch">
                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:Room}">
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0} {1}">
                                        <Binding Path="Building" />
                                        <Binding Path="RoomNumber" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </Grid>

            <TextBlock Text="Notes" />
            <TextBox Text="{Binding Notes}" AcceptsReturn="True" Height="60" />

            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Save" Command="{Binding SaveCommand}" />
                <Button Content="Cancel" Command="{Binding CancelCommand}" />
            </StackPanel>
        </StackPanel>
    </ScrollViewer>

</Window>

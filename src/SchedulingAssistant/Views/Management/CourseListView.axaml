<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SchedulingAssistant.ViewModels.Management"
             x:Class="SchedulingAssistant.Views.Management.CourseListView"
             x:DataType="vm:CourseListViewModel"
             x:CompileBindings="False">

    <ScrollViewer>
        <Border Padding="0,0,12,12">
            <StackPanel Spacing="20">

            <!-- ═══════════════════════════════════════════════════════════ -->
            <!-- SUBJECTS SECTION                                            -->
            <!-- ═══════════════════════════════════════════════════════════ -->

            <StackPanel Spacing="12">
                <TextBlock Text="Subjects" FontSize="20" FontWeight="SemiBold" />

                <!-- Subject edit form -->
                <ContentControl Content="{Binding SubjectEditVm}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate DataType="{x:Type vm:SubjectEditViewModel}">
                            <StackPanel Spacing="12" MaxWidth="400" HorizontalAlignment="Left">
                                <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="SemiBold" />

                                <TextBlock Text="Name (e.g. Mathematics)" />
                                <TextBox Text="{Binding Name}" />

                                <TextBlock Text="Calendar Abbreviation (e.g. MATH)" />
                                <TextBox Text="{Binding CalendarAbbreviation}" />

                                <TextBlock Text="{Binding ValidationError}"
                                           Foreground="{StaticResource TextError}" FontSize="12"
                                           IsVisible="{Binding ValidationError, Converter={x:Static ObjectConverters.IsNotNull}}" />

                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Button Content="Save" Command="{Binding SaveCommand}" />
                                    <Button Content="Cancel" Command="{Binding CancelCommand}" />
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>

                <!-- Subject list -->
                <DataGrid ItemsSource="{Binding Subjects}"
                          SelectedItem="{Binding SelectedSubject}"
                          IsVisible="{Binding SubjectEditVm, Converter={x:Static ObjectConverters.IsNull}}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserSortColumns="True"
                          MaxHeight="200">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                        <DataGridTextColumn Header="Calendar Abbreviation" Binding="{Binding CalendarAbbreviation}" Width="150" />
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Subject toolbar -->
                <StackPanel Orientation="Horizontal" Spacing="8"
                            IsVisible="{Binding SubjectEditVm, Converter={x:Static ObjectConverters.IsNull}}">
                    <Button Content="Add Subject" Command="{Binding AddSubjectCommand}" />
                    <Button Content="Edit Subject" Command="{Binding EditSubjectCommand}"
                            IsEnabled="{Binding SelectedSubject, Converter={x:Static ObjectConverters.IsNotNull}}" />
                    <Button Content="Delete Subject" Command="{Binding DeleteSubjectCommand}"
                            IsEnabled="{Binding SelectedSubject, Converter={x:Static ObjectConverters.IsNotNull}}" />
                </StackPanel>
            </StackPanel>

            <!-- ═══════════════════════════════════════════════════════════ -->
            <!-- COURSES SECTION                                             -->
            <!-- ═══════════════════════════════════════════════════════════ -->

            <StackPanel Spacing="12">
                <TextBlock Text="Courses" FontSize="20" FontWeight="SemiBold" />

                <!-- Advisory message when no subjects exist -->
                <TextBlock Text="Create at least one subject first"
                           Foreground="#888888" FontSize="13"
                           IsVisible="{Binding HasSubjects, Converter={x:Static BoolConverters.Not}}" />

                <!-- Course edit form -->
                <ContentControl Content="{Binding EditVm}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate DataType="{x:Type vm:CourseEditViewModel}">
                            <StackPanel Spacing="12" MaxWidth="400" HorizontalAlignment="Left">
                                <TextBlock Text="{Binding FormTitle}" FontSize="16" FontWeight="SemiBold" />

                                <TextBlock Text="Subject" />
                                <ComboBox ItemsSource="{Binding Subjects}"
                                          SelectedItem="{Binding SelectedSubject}"
                                          DisplayMemberBinding="{Binding Name}" />

                                <TextBlock Text="Course Number (3 digits, e.g. 101)" />
                                <TextBox Text="{Binding CourseNumber}" />

                                <TextBlock Text="Calendar Code (computed)" Foreground="#666" FontSize="12" />
                                <TextBlock Text="{Binding ComputedCalendarCode}" Background="#F5F5F5" Padding="8,4" />

                                <TextBlock Text="{Binding ValidationError}"
                                           Foreground="{StaticResource TextError}" FontSize="12"
                                           IsVisible="{Binding ValidationError, Converter={x:Static ObjectConverters.IsNotNull}}" />

                                <TextBlock Text="Title" />
                                <TextBox Text="{Binding CourseTitle}" />

                                <CheckBox Content="Active" IsChecked="{Binding IsActive}" />

                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Button Content="Save" Command="{Binding SaveCommand}" />
                                    <Button Content="Cancel" Command="{Binding CancelCommand}" />
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>

                <!-- Course list -->
                <DataGrid ItemsSource="{Binding Courses}"
                          SelectedItem="{Binding SelectedCourse}"
                          IsVisible="{Binding EditVm, Converter={x:Static ObjectConverters.IsNull}}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserSortColumns="True"
                          MaxHeight="300">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Calendar Code" Binding="{Binding CalendarCode}" Width="150" />
                        <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*" />
                        <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="80" />
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Course toolbar -->
                <StackPanel Orientation="Horizontal" Spacing="8"
                            IsVisible="{Binding EditVm, Converter={x:Static ObjectConverters.IsNull}}">
                    <Button Content="Add Course" Command="{Binding AddCommand}"
                            IsEnabled="{Binding SelectedSubject, Converter={x:Static ObjectConverters.IsNotNull}}" />
                    <Button Content="Edit Course" Command="{Binding EditCommand}"
                            IsEnabled="{Binding SelectedCourse, Converter={x:Static ObjectConverters.IsNotNull}}" />
                    <Button Content="Delete Course" Command="{Binding DeleteCommand}"
                            IsEnabled="{Binding SelectedCourse, Converter={x:Static ObjectConverters.IsNotNull}}" />
                </StackPanel>
            </StackPanel>

        </StackPanel>
        </Border>
    </ScrollViewer>
</UserControl>

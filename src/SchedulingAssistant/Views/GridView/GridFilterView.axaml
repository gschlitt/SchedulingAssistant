<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SchedulingAssistant.ViewModels.GridView"
             x:Class="SchedulingAssistant.Views.GridView.GridFilterView"
             x:DataType="vm:GridFilterViewModel"
             x:CompileBindings="False">

    <UserControl.Styles>
        <!-- Compact checkbox style inside popups -->
        <Style Selector="CheckBox">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="MinHeight" Value="0" />
        </Style>
        <!-- Filter dimension toggle buttons: look like a label, highlight when active -->
        <Style Selector="ToggleButton.FilterDim">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="6,2" />
            <Setter Property="MinHeight" Value="0" />
            <Setter Property="MinWidth" Value="0" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Cursor" Value="Hand" />
        </Style>
        <Style Selector="ToggleButton.FilterDim:pointerover">
            <Setter Property="Background" Value="{StaticResource ButtonHover}" />
        </Style>
        <Style Selector="ToggleButton.FilterDim:checked">
            <Setter Property="Background" Value="{StaticResource FilterExpanderBorder}" />
        </Style>
        <!-- ListBox inside popup: no selection highlight â€” checkboxes handle state -->
        <Style Selector="ListBox.FilterList">
            <Setter Property="Background" Value="{StaticResource FilterExpanderContent}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="2" />
        </Style>
        <Style Selector="ListBox.FilterList ListBoxItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="MinHeight" Value="0" />
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="ListBox.FilterList ListBoxItem:selected /template/ ContentPresenter">
            <Setter Property="Background" Value="Transparent" />
        </Style>
        <Style Selector="ListBox.FilterList ListBoxItem:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{StaticResource ButtonHover}" />
        </Style>
    </UserControl.Styles>

    <Border Background="{StaticResource FilterBarBackground}"
            BorderBrush="{StaticResource ChromeBorder}"
            BorderThickness="0,0,0,1"
            Padding="4,1">

        <DockPanel>

            <!-- Right side: Clear All button + active summary -->
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal"
                        Spacing="6" VerticalAlignment="Center" Margin="6,0,0,0">
                <Border Width="1" Background="{StaticResource SeparatorLine}" Margin="0,4" />
                <Button Content="Clear All"
                        Command="{Binding ClearAllCommand}"
                        IsEnabled="{Binding IsActive}"
                        FontSize="10"
                        Padding="6,2"
                        MinHeight="0" MinWidth="0"
                        VerticalAlignment="Center" />
            </StackPanel>

<!-- Left side: horizontal row of filter dimension buttons + popups -->
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal" Spacing="1" VerticalAlignment="Center">

                    <!-- Instructor -->
                    <Panel x:Name="InstructorPanel" IsVisible="True">
                        <ToggleButton x:Name="InstructorToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="InstructorPopup"
                               PlacementTarget="{Binding #InstructorToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #InstructorToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding Instructors}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                    <!-- Room -->
                    <Panel x:Name="RoomPanel" IsVisible="True">
                        <ToggleButton x:Name="RoomToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="RoomPopup"
                               PlacementTarget="{Binding #RoomToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #RoomToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding Rooms}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                    <!-- Subject -->
                    <Panel x:Name="SubjectPanel" IsVisible="True">
                        <ToggleButton x:Name="SubjectToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="SubjectPopup"
                               PlacementTarget="{Binding #SubjectToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #SubjectToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding Subjects}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                    <!-- Campus -->
                    <Panel x:Name="CampusPanel" IsVisible="True">
                        <ToggleButton x:Name="CampusToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="CampusPopup"
                               PlacementTarget="{Binding #CampusToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #CampusToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding Campuses}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                    <!-- Section Type -->
                    <Panel x:Name="SectionTypePanel" IsVisible="True">
                        <ToggleButton x:Name="SectionTypeToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="SectionTypePopup"
                               PlacementTarget="{Binding #SectionTypeToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #SectionTypeToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding SectionTypes}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                    <!-- Tags -->
                    <Panel x:Name="TagsPanel" IsVisible="True">
                        <ToggleButton x:Name="TagsToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="TagsPopup"
                               PlacementTarget="{Binding #TagsToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #TagsToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding Tags}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                    <!-- Meeting Type -->
                    <Panel x:Name="MeetingTypePanel" IsVisible="True">
                        <ToggleButton x:Name="MeetingTypeToggle"
                                      Classes="FilterDim"
                                      VerticalAlignment="Center" />
                        <Popup x:Name="MeetingTypePopup"
                               PlacementTarget="{Binding #MeetingTypeToggle}"
                               Placement="Bottom"
                               IsOpen="{Binding #MeetingTypeToggle.IsChecked, Mode=TwoWay}"
                               IsLightDismissEnabled="True">
                            <Border Background="{StaticResource FilterExpanderContent}"
                                    BorderBrush="{StaticResource FilterExpanderBorder}"
                                    BorderThickness="1" CornerRadius="3"
                                    Padding="2" MaxHeight="220" MinWidth="120">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ListBox Classes="FilterList"
                                             ItemsSource="{Binding MeetingTypes}"
                                             SelectionMode="Multiple">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          Content="{Binding Name}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Panel>

                </StackPanel>
            </ScrollViewer>

        </DockPanel>
    </Border>

</UserControl>
